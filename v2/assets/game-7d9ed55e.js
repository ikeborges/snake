import{F as d,G as g}from"./GameAPIClient-f143d4fb.js";var o=(i=>(i.UP="UP",i.DOWN="DOWN",i.LEFT="LEFT",i.RIGHT="RIGHT",i))(o||{});const l=i=>{switch(i){case"UP":return"DOWN";case"DOWN":return"UP";case"LEFT":return"RIGHT";case"RIGHT":return"LEFT"}},r={FRAME_HEIGHT:600,FRAME_WIDTH:400,BLOCK_SIZE:20};class a{constructor(t,e){this.x=t,this.y=e}static generateRandomPosition(){const t=Math.floor(Math.random()*(r.FRAME_WIDTH/r.BLOCK_SIZE)),e=Math.floor(Math.random()*(r.FRAME_HEIGHT/r.BLOCK_SIZE));return new a(t,e)}static from(t){return new a(t.x,t.y)}equals(t){return this.x===t.x&&this.y===t.y}}class m{constructor(t=a.generateRandomPosition()){this.position=new a(t.x,t.y)}getPosition(){return this.position}}class p{constructor(t,e){this.direction=t,this.position=e}getPosition(){return this.position}getDirection(){return this.direction}}class h{constructor(t,e){this.position=t,this.direction=e}getPosition(){return this.position}getDirection(){return this.direction}turnTo(t){this.direction=t}moveOneStep(){const t=r.FRAME_HEIGHT/r.BLOCK_SIZE,e=r.FRAME_WIDTH/r.BLOCK_SIZE,s=t-1,n=e-1;switch(this.direction){case o.UP:this.position.y===0?this.position.y=s:this.position.y-=1;break;case o.DOWN:this.position.y===s?this.position.y=0:this.position.y+=1;break;case o.LEFT:this.position.x===0?this.position.x=n:this.position.x-=1;break;case o.RIGHT:this.position.x===n?this.position.x=0:this.position.x+=1;break}}}class y{constructor(){this.items=[]}enqueue(t){this.items.push(t)}dequeue(){return this.items.shift()}asArray(){return this.items}}class w{constructor(t=3){this.body=[],this.directionChanges=new y,this.populateBody(t)}populateBody(t){for(let e=0;e<t;e++){const s=new h(new a(1,e+1),o.UP);this.body.push(s)}}appendBodyPart(){const t=this.getTail();let e;switch(t.getDirection()){case o.UP:e=new a(t.getPosition().x,t.getPosition().y+1);break;case o.DOWN:e=new a(t.getPosition().x,t.getPosition().y-1);break;case o.LEFT:e=new a(t.getPosition().x+1,t.getPosition().y);break;case o.RIGHT:e=new a(t.getPosition().x-1,t.getPosition().y);break}this.body.push(new h(e,t.getDirection()))}getBody(){return this.body}getHead(){return this.body[0]}getTail(){return this.body.at(-1)||new h(new a(0,0),o.UP)}getLength(){return this.body.length}getPositions(){return this.body.map(t=>t.getPosition())}shouldEatFood(t){return this.getHead().getPosition().equals(t)}eat(){this.appendBodyPart()}turnSnakeTo(t){const e=this.getHead();if(t===e.getDirection()||t===l(e.getDirection()))return;const s=a.from(e.getPosition()),n=new p(t,s);this.directionChanges.enqueue(n)}collisionHappened(){for(const[t,e]of Object.entries(this.body))if(parseInt(t)>0&&this.getHead().getPosition().equals(e.getPosition()))return!0;return!1}moveOneStep(){let t=!1;this.directionChanges.asArray().forEach(e=>{this.body.forEach((s,n,c)=>{e.getPosition().equals(s.getPosition())&&(s.turnTo(e.getDirection()),n===c.length-1&&(t=!0))})}),t&&this.directionChanges.dequeue(),this.body.forEach(e=>e.moveOneStep())}}class E{constructor(){this.food=new m,this.snake=new w,this.status={score:0,startTime:Date.now(),gameEnded:!1}}turnSnakeTo(t){this.snake.turnSnakeTo(t)}runCycle(){return this.snake.collisionHappened()&&(this.status.gameEnded=!0),this.snake.shouldEatFood(this.food.getPosition())&&(this.snake.eat(),this.food=new m,this.status.score+=1),this.snake.moveOneStep(),this.status}getSnakePositions(){return this.snake.getPositions()}getFoodPosition(){return this.food.getPosition()}}class T{constructor(t,e,s){this.window=t,this.document=e,this.context=s,this.previousTimestamp=0,this.playerName="John Doe",this.context.fillStyle="white",this.game=new E,this.addKeyboardListeners()}retrievePlayername(){}start(){const t=this.document.getElementById("game-start"),e=this.document.getElementById("player-data"),s=this.document.getElementById("player-name");e.addEventListener("submit",n=>{n.preventDefault(),this.playerName=s.value,t.className=""}),this.gameLoop()}addKeyboardListeners(){const t=new Map([["ArrowUp",o.UP],["ArrowDown",o.DOWN],["ArrowLeft",o.LEFT],["ArrowRight",o.RIGHT]]);this.document.addEventListener("keydown",e=>{t.has(e.key)&&this.game.turnSnakeTo(t.get(e.key))})}drawBlock(t,e){const{BLOCK_SIZE:s}=r;this.context.fillRect(t*s,e*s,1*s,1*s)}drawFood({x:t,y:e}){this.drawBlock(t,e)}drawSnake(t){t.forEach(({x:e,y:s})=>{this.drawBlock(e,s)})}drawFrame(){const t=this.game.getSnakePositions(),e=this.game.getFoodPosition();this.drawFood(e),this.drawSnake(t)}updateView(t){const e=document.getElementById("score");e.innerText=t.score.toString();const s=document.getElementById("time"),n=new Date(Date.now()-t.startTime);s.innerText=d.formatElapsedTime(n)}async gameOver(t){const e=this.document.getElementById("game-over");e.className="active";const s=document.getElementById("final-score");s.innerText=t.score.toString();const n=document.getElementById("time-elapsed"),c=new Date(Date.now()-t.startTime);n.innerText=d.formatElapsedTime(c);try{await g.saveStatsInRanking(this.playerName,t.score,c.getTime())}catch(u){console.error(u)}}gameLoop(t=0){const e=t-this.previousTimestamp;if(!this.previousTimestamp||e>=200){this.previousTimestamp=t;const s=this.game.runCycle();if(s.gameEnded)return this.gameOver(s);this.updateView(s);const{FRAME_WIDTH:n,FRAME_HEIGHT:c}=r;this.context.clearRect(0,0,n,c),this.drawFrame()}this.window.requestAnimationFrame(this.gameLoop.bind(this))}}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("game-canvas").getContext("2d");new T(window,document,t).start()});
